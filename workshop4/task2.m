pi=3.1415926;
R11=0.912;
P11=127.1;
R12=0.041;
P12=26;
R21=1.721;
P21=35.6;
R22=0.75;
P22=143.9;
S11=R11*cos(P11/180*pi)+R11*sin(P11/180*pi)*j;
S12=R12*cos(P12/180*pi)+R12*sin(P12/180*pi)*j;
S21=R21*cos(P21/180*pi)+R21*sin(P21/180*pi)*j;
S22=R22*cos(P22/180*pi)+R22*sin(P22/180*pi)*j;
delta=S11*S22-S12*S21;
B1=1+abs(S11)^2-abs(S22)^2-abs(delta)^2;
B2=1+abs(S22)^2-abs(S11)^2-abs(delta)^2;
C1=S11-delta*conj(S22);
C2=S22-delta*conj(S11);
GammaS=(B1+sqrt(B1^2-4*abs(C1)^2))/(2*C1);
GammaS_2=(B1-sqrt(B1^2-4*abs(C1)^2))/(2*C1);
GammaL=(B2+sqrt(B2^2-4*abs(C2)^2))/(2*C2);
GammaL_2=(B2-sqrt(B2^2-4*abs(C2)^2))/(2*C2);
G=(abs(S21)^2*(1-abs(GammaL)^2))/((1-abs(GammaS)^2)*(abs(1-GammaL*S22)^2));
GammaS_T=conj(S11+GammaL_2*S12*S21/(1-S22*GammaL_2));
Gs=1/(1-abs(GammaS_T)^2);
G0=abs(S21)^2;
Gl=(1-abs(GammaL_2)^2)/abs(1-S22*GammaL_2)^2;
GTMAX=Gs*G0*Gl;